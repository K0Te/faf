Name: faf
Version: @PACKAGE_VERSION@
Release: 1%{?dist}
Summary: Software Problem Analysis Tool
Group: Development/Libraries
License: GPLv3+
URL: https://github.com/abrt/faf/
Source0: https://fedorahosted.org/released/faf/faf-%{version}.tar.xz

BuildArch: noarch

%if 0%{?rhel:%{rhel} < 7}
%define ipython ipython
%define sqlalchemy python-sqlalchemy0.7
%else
%define ipython python-ipython-console
%define sqlalchemy python-sqlalchemy >= 0.7
%endif

Requires(pre): shadow-utils

Requires: python-setuptools
Requires: %{sqlalchemy}

BuildRequires: autoconf
BuildRequires: intltool
BuildRequires: libtool

%description
faf is a programmable tool for analysis of packages, packaging
issues, bug reports and other artifacts produced during software
development.

%package problem-coredump
Summary: %{name}'s coredump plugin
Requires: %{name} = %{version}

%description problem-coredump
A plugin for %{name} handling user-space binary crashes.

%package problem-kerneloops
Summary: %{name}'s kerneloops plugin
Requires: %{name} = %{version}

%description problem-kerneloops
A plugin for %{name} handling kernel oopses.

%package problem-python
Summary: %{name}'s python plugin
Requires: %{name} = %{version}

%description problem-python
A plugin for %{name} handling python scripts problems.

%package yum
Summary: %{name}'s yum plugin
Requires: %{name} = %{version}
Requires: yum
Requires: yum-utils

%description yum
A plugin for %{name} implementing unified access to yum repositories.

%package opsys-fedora
Summary: %{name}'s Fedora operating system plugin
Requires: %{name} = %{version}
Requires: python-fedora

%description opsys-fedora
A plugin for %{name} implementing support for Fedora operating system.

%package action-save-reports
Summary: %{name}'s save-reports plugin
Requires: %{name} = %{version}

%description action-save-reports
A plugin for %{name} implementing save-reports action

%package action-shell
Summary: %{name}'s shell plugin
Requires: %{name} = %{version}
Requires: %{ipython}

%description action-shell
A plugin for %{name} allowing to run IPython shell

%package action-pull-releases
Summary: %{name}'s pull-releases plugin
Requires: %{name} = %{version}

%description action-pull-releases
A plugin for %{name} implementing pull-releases action

%package action-pull-components
Summary: %{name}'s pull-components plugin
Requires: %{name} = %{version}

%description action-pull-components
A plugin for %{name} implementing pull-components action

%package action-repo
Summary: %{name}'s repo plugin
Requires: %{name} = %{version}

%description action-repo
A plugin for %{name} implementing repoadd, repolist and reposync actions

%package action-arch
Summary: %{name}'s arch plugin
Requires: %{name} = %{version}

%description action-arch
A plugin for %{name} implementing archadd action

%package action-retrace
Summary: %{name}'s retrace plugin
Requires: %{name} = %{version}

%description action-retrace
A plugin for %{name} implementing retrace action

%prep
%setup -q
./autogen.sh

%build
%configure
make %{?_smp_mflags}

%install
make install DESTDIR=%{buildroot}

# /etc
mkdir -p %{buildroot}%{_sysconfdir}/faf
mkdir -p %{buildroot}%{_sysconfdir}/faf/plugins
mkdir -p %{buildroot}%{_sysconfdir}/faf/templates

# /var/spool
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/lob
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/reports
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/reports/incoming
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/reports/deferred
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/reports/saved
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/attachments/
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/attachments/incoming
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/attachments/deferred
mkdir -p %{buildroot}%{_localstatedir}/spool/faf/attachments/saved

# /var/log
mkdir -p %{buildroot}%{_localstatedir}/log/faf/

%check
#make check

%pre
# http://fedoraproject.org/wiki/Packaging:UsersAndGroups
getent group faf >/dev/null || groupadd --system faf
getent passwd faf >/dev/null || useradd --system -g faf -d /etc/faf -s /sbin/nologin faf
exit 0

%files
# /etc
%dir %{_sysconfdir}/faf
%dir %{_sysconfdir}/faf/plugins
%dir %{_sysconfdir}/faf/templates
%config(noreplace) %{_sysconfdir}/faf/faf.conf

# /var/spool
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/lob
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/reports
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/reports/incoming
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/reports/saved
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/reports/deferred
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/attachments
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/attachments/incoming
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/attachments/deferred
%dir %attr(0775, faf, faf) %{_localstatedir}/spool/faf/attachments/saved

# /var/log
%dir %attr(0775, faf, faf) %{_localstatedir}/log/faf

# /usr/bin
%{_bindir}/faf

# /usr/lib/python*/pyfaf
%dir %{python_sitelib}/pyfaf
%{python_sitelib}/pyfaf/__init__.py*
%{python_sitelib}/pyfaf/checker.py*
%{python_sitelib}/pyfaf/cmdline.py*
%{python_sitelib}/pyfaf/common.py*
%{python_sitelib}/pyfaf/config.py*
%{python_sitelib}/pyfaf/decorators.py*
%{python_sitelib}/pyfaf/format.py*
%{python_sitelib}/pyfaf/local.py*
%{python_sitelib}/pyfaf/parse.py*
%{python_sitelib}/pyfaf/proc.py*
%{python_sitelib}/pyfaf/rpm.py*
%{python_sitelib}/pyfaf/queries.py*
%{python_sitelib}/pyfaf/ureport.py*
%{python_sitelib}/pyfaf/ureport_compat.py*

%dir %{python_sitelib}/pyfaf/actions
%{python_sitelib}/pyfaf/actions/__init__.py*

%dir %{python_sitelib}/pyfaf/bugtrackers
%{python_sitelib}/pyfaf/bugtrackers/__init__.py*

%dir %{python_sitelib}/pyfaf/opsys
%{python_sitelib}/pyfaf/opsys/__init__.py*

%dir %{python_sitelib}/pyfaf/problemtypes
%{python_sitelib}/pyfaf/problemtypes/__init__.py*

%dir %{python_sitelib}/pyfaf/repos
%{python_sitelib}/pyfaf/repos/__init__.py*

%dir %{python_sitelib}/pyfaf/storage
%{python_sitelib}/pyfaf/storage/__init__.py*
%{python_sitelib}/pyfaf/storage/common.py*
%{python_sitelib}/pyfaf/storage/debug.py*
%{python_sitelib}/pyfaf/storage/hub.py*
%{python_sitelib}/pyfaf/storage/kb.py*
%{python_sitelib}/pyfaf/storage/llvm.py*
%{python_sitelib}/pyfaf/storage/opsys.py*
%{python_sitelib}/pyfaf/storage/problem.py*
%{python_sitelib}/pyfaf/storage/project.py*
%{python_sitelib}/pyfaf/storage/report.py*
%{python_sitelib}/pyfaf/storage/rhbz.py*
%{python_sitelib}/pyfaf/storage/symbol.py*

%dir %{python_sitelib}/pyfaf/storage/fixtures
%{python_sitelib}/pyfaf/storage/fixtures/__init__.py*
%{python_sitelib}/pyfaf/storage/fixtures/data.py*
%{python_sitelib}/pyfaf/storage/fixtures/randutils.py*

# /usr/share/faf
%dir %{_datadir}/faf
%{_datadir}/faf/fixtures/lob_download_location

%dir %{_datadir}/faf/fixtures/sql
%{_datadir}/faf/fixtures/sql/archs.sql
%{_datadir}/faf/fixtures/sql/archstags.sql
%{_datadir}/faf/fixtures/sql/buildarchs.sql
%{_datadir}/faf/fixtures/sql/builds.sql
%{_datadir}/faf/fixtures/sql/buildstags.sql
%{_datadir}/faf/fixtures/sql/buildsys.sql
%{_datadir}/faf/fixtures/sql/opsys.sql
%{_datadir}/faf/fixtures/sql/opsyscomponents.sql
%{_datadir}/faf/fixtures/sql/opsysreleases.sql
%{_datadir}/faf/fixtures/sql/opsysreleasescomponents.sql
%{_datadir}/faf/fixtures/sql/packages.sql
%{_datadir}/faf/fixtures/sql/taginheritances.sql
%{_datadir}/faf/fixtures/sql/tags.sql

%files problem-coredump
%{python_sitelib}/pyfaf/problemtypes/core.py*

%files problem-kerneloops
%{python_sitelib}/pyfaf/problemtypes/kerneloops.py*

%files problem-python
%{python_sitelib}/pyfaf/problemtypes/python.py*

%files yum
%{python_sitelib}/pyfaf/repos/yum.py*

%files opsys-fedora
%{python_sitelib}/pyfaf/opsys/fedora.py*

%files action-save-reports
%{python_sitelib}/pyfaf/actions/save_reports.py*

%files action-shell
%{python_sitelib}/pyfaf/actions/shell.py*

%files action-pull-releases
%{python_sitelib}/pyfaf/actions/pull_releases.py*

%files action-pull-components
%{python_sitelib}/pyfaf/actions/pull_components.py*

%files action-repo
%{python_sitelib}/pyfaf/actions/repoadd.py*
%{python_sitelib}/pyfaf/actions/repolist.py*
%{python_sitelib}/pyfaf/actions/reposync.py*

%files action-arch
%{python_sitelib}/pyfaf/actions/archadd.py*

%files action-retrace
%{python_sitelib}/pyfaf/actions/retrace.py*

%changelog
* Mon Apr 15 2013 Michal Toman <mtoman@redhat.com> 0.9-1
- Initial packaging
